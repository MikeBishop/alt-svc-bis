<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Alt-Svc Fixes and Feature Candidates</title>
<meta content="Erik Nygren" name="author">
<meta content="
       HTTP Alternative Services has become the primary mechanism for HTTP/3 upgrade,
but overlaps with and disagrees with other developing standards, such as the
HTTPS resource record in DNS. This document explores a set of potential fixes
and/or additional features for Alt-Svc. It is used to record and share thoughts,
and is not expected to progress on its own. 
    " name="description">
<meta content="xml2rfc 3.10.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-nygren-altsvc-fixes" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.10.0
    Python 3.9.5
    appdirs 1.4.4
    ConfigArgParse 1.3
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.3
    pycountry 20.7.3
    pyflakes 2.3.0
    PyYAML 5.4.1
    requests 2.25.1
    setuptools 52.0.0
    six 1.15.0
-->
<link href="draft-nygren-altsvc-fixes.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

html {
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  scrollbar-color: #bbb #eee;
}
@media (prefers-color-scheme: dark) {
html {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
#title, #rfcnum {
  margin: 1.5em 0 0.2em;
}
#rfcnum + #title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
dd.break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href].selfRef {
  color: var(--text-color);
}
a[href] {
  color: var(--link-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px 'Oxygen Mono', monospace;
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines */
  line-height: 0;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  pre {
    display: inline-block;
    overflow-x: auto;
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  pre + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
tr:nth-child(2n) > td {
  background-color: var(--background-color);
}
tr:nth-child(2n+1) > td {
  background-color: var(--highlight-color);
}
thead+tbody > tr:nth-child(2n) > td {
  background-color: var(--highlight-color);
}
thead+tbody > tr:nth-child(2n+1) > td {
  background-color: var(--background-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 8em;
}
#identifiers dt {
  width: var(--identifier-width);
  margin: 0;
  clear: left;
  float: left;
  text-align: right;
}
#identifiers dd {
  margin: 0 0 0 calc(1em + var(--identifier-width));
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 500px) {
  .index ul {
    column-count: 2;
    column-gap: 20px;
  }
  .index ul ul {
    column-count: 1;
    column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul p, #toc ul li {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table .text-left, table .text-left {
  text-align: left;
}
table .text-center, table .text-center {
  text-align: center;
}
table .text-right, table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Give the table caption label the same styling as the figcaption */

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  dd {
    page-break-before: avoid;
  }
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
</style>

</head>
<body>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Alt-Svc Fixes</td>
<td class="right">October 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Nygren</td>
<td class="center">Expires 7 April 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">TODO Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-nygren-altsvc-fixes</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2021-10-04" class="published">4 October 2021</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-04-07">7 April 2022</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">E. Nygren</div>
<div class="org">Akamai</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Alt-Svc Fixes and Feature Candidates</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">HTTP Alternative Services has become the primary mechanism for HTTP/3 upgrade,
but overlaps with and disagrees with other developing standards, such as the
HTTPS resource record in DNS. This document explores a set of potential fixes
and/or additional features for Alt-Svc. It is used to record and share thoughts,
and is not expected to progress on its own.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Discussion of this document takes place on the
    mailing list (httpbis@ietf.org),
  which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/httpbis/">https://mailarchive.ietf.org/arch/browse/httpbis/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">Source for this draft and an issue tracker can be found at
  <span><a href="https://github.com/MikeBishop/alt-svc-bis">https://github.com/MikeBishop/alt-svc-bis</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 7 April 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-overview" class="xref">Overview</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-potential-scope-items" class="xref">Potential Scope Items</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1" class="keepWithNext"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-incorporating-errata-and-ed" class="xref">Incorporating errata and Editorial improvements</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1" class="keepWithNext"><a href="#section-2.2" class="xref">2.2</a>.  <a href="#name-fix-alpn-handling" class="xref">Fix ALPN handling</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="xref">2.3</a>.  <a href="#name-address-concerns-about-alt-" class="xref">Address concerns about Alt-Svc lifetime bounding</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.4">
                <p id="section-toc.1-1.2.2.4.1"><a href="#section-2.4" class="xref">2.4</a>.  <a href="#name-support-ech" class="xref">Support ECH</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.5">
                <p id="section-toc.1-1.2.2.5.1"><a href="#section-2.5" class="xref">2.5</a>.  <a href="#name-better-interactions-with-ht" class="xref">Better Interactions with HTTPS Record</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.6">
                <p id="section-toc.1-1.2.2.6.1"><a href="#section-2.6" class="xref">2.6</a>.  <a href="#name-http-3-frame-definition" class="xref">HTTP/3 Frame Definition</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.7">
                <p id="section-toc.1-1.2.2.7.1"><a href="#section-2.7" class="xref">2.7</a>.  <a href="#name-accept-alt-svc-request-head" class="xref">Accept-Alt-Svc Request Header</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.8">
                <p id="section-toc.1-1.2.2.8.1"><a href="#section-2.8" class="xref">2.8</a>.  <a href="#name-improve-replace-alt-used-he" class="xref">Improve/Replace Alt-Used Header</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.9">
                <p id="section-toc.1-1.2.2.9.1"><a href="#section-2.9" class="xref">2.9</a>.  <a href="#name-path-scoped-alt-svc" class="xref">Path-Scoped Alt-Svc</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.10">
                <p id="section-toc.1-1.2.2.10.1"><a href="#section-2.10" class="xref">2.10</a>. <a href="#name-persist-and-caching-concern" class="xref">Persist and Caching Concerns</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.11">
                <p id="section-toc.1-1.2.2.11.1"><a href="#section-2.11" class="xref">2.11</a>. <a href="#name-radical-simplification" class="xref">Radical Simplification</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#appendix-A" class="xref"></a><a href="#name-acknowledgments" class="xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#appendix-B" class="xref"></a><a href="#name-authors-address" class="xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="overview">
<section id="section-1">
      <h2 id="name-overview">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-overview" class="section-name selfRef">Overview</a>
      </h2>
<p id="section-1-1">Alt-Svc <span>[<a href="#AltSvc" class="xref">AltSvc</a>]</span> was published in April of 2016.  Since then, it has
become the primary mechanism to upgrade connections to HTTP/3, at least until
HTTPS RRs <span>[<a href="#SVCB" class="xref">SVCB</a>]</span> are standardized and widely
supported.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">This brainstorms a set of potential fixes and feature candidates for an Alt-Svc
BIS.  In the spirit of brainstorming, some of the things in this list may be bad
ideas. One of the points of this document is to judge interest in each of these
items to determine what potential authors may be interested in including in a
draft.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">A number of these items were deferred out of the SVCB/HTTPS draft.  Others are
based on regrets from implementation experience with AltSvc.  A few are
potentially valuable features.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">It is not yet defined whether this should be a new header or can be done via
extensions to Alt-Svc as it exists today.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">A number of major clients have yet to implement Alt-Svc to other hostnames
fully, and some of this is due to concerns that they have with the current
specification.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">It may make sense to split this list into batches, but another option would be
to try and get all of these done at once even if as separate but cooperating
drafts.<a href="#section-1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="potential-scope-items">
<section id="section-2">
      <h2 id="name-potential-scope-items">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-potential-scope-items" class="section-name selfRef">Potential Scope Items</a>
      </h2>
<div id="incorporating-errata-and-editorial-improvements">
<section id="section-2.1">
        <h3 id="name-incorporating-errata-and-ed">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-incorporating-errata-and-ed" class="section-name selfRef">Incorporating errata and Editorial improvements</a>
        </h3>
<p id="section-2.1-1">(Hopefully this is non-controversial.)<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2">Includes:<a href="#section-2.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.1-3.1">Incorporate errata<a href="#section-2.1-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.1-3.2">Reference RFC 8336 "ORIGIN Frames" (regarding disabling connection coalescing)<a href="#section-2.1-3.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.1-3.3">Incorporate <span>[<a href="#I-D.pardue-httpbis-dont-be-clear" class="xref">I-D.pardue-httpbis-dont-be-clear</a>]</span><a href="#section-2.1-3.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.1-3.4">...<a href="#section-2.1-3.4" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="fix-alpn-handling">
<section id="section-2.2">
        <h3 id="name-fix-alpn-handling">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-fix-alpn-handling" class="section-name selfRef">Fix ALPN handling</a>
        </h3>
<p id="section-2.2-1">The ALPN semantics in <span>[<a href="#AltSvc" class="xref">AltSvc</a>]</span> are ambiguous, and problematic in some
interpretations. We should update <span>[<a href="#AltSvc" class="xref">AltSvc</a>]</span> to give it well-defined semantics
that match the HTTPS RRs.  For example, specify that the ALPN <span>[<a href="#ALPN" class="xref">ALPN</a>]</span>
negotiated via the TLS handshake does not need to be the same as the ALPN
indicated in the AltSvc.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2-2">(From <a href="https://github.com/MikeBishop/dns-alt-svc/issues/246">HTTPS RR #246</a> and other discussion
threads during HTTPS RR.  David Benjamin also has strong opinions on this
topic.)<a href="#section-2.2-2" class="pilcrow">¶</a></p>
<p id="section-2.2-3">One option would be to pull in the text we landed on for the HTTPS/SVCB draft,
see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-dnsop-svcb-https-07#section-6.1" class="relref">Section 6.1</a> of [<a href="#SVCB" class="xref">SVCB</a>]</span>.  See also <span>[<a href="#I-D.thomson-tls-snip" class="xref">I-D.thomson-tls-snip</a>]</span>.<a href="#section-2.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="address-concerns-about-alt-svc-lifetime-bounding">
<section id="section-2.3">
        <h3 id="name-address-concerns-about-alt-">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-address-concerns-about-alt-" class="section-name selfRef">Address concerns about Alt-Svc lifetime bounding</a>
        </h3>
<p id="section-2.3-1">Some people have expressed concerns that Alt-Svc allows a compromised Origin to
hold onto clients forever by continuing to offer updated Alt-Svc entries.  There
may be ways to reduce the vulnerability exposure here, such as by periodic
reconfirmation with the "real" origin or something it controls.  This is of
particular concern when an Alt-Svc record has a much longer lifetime than an
HTTPS RR.<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<p id="section-2.3-2">For example, if the Alt-Svc records were signed with a key published in DNS.
Records remain valid so long as the key that signed them is still claimed by the
domain.  An unsigned record has a very short lifetime bound.<a href="#section-2.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="support-ech">
<section id="section-2.4">
        <h3 id="name-support-ech">
<a href="#section-2.4" class="section-number selfRef">2.4. </a><a href="#name-support-ech" class="section-name selfRef">Support ECH</a>
        </h3>
<p id="section-2.4-1">The HTTPS RR <span>[<a href="#SVCB" class="xref">SVCB</a>]</span> is currently the only way to retrieve keys for Encrypted
Client Hello <span>[<a href="#ECH" class="xref">ECH</a>]</span>.  To maintain security, it puts Alt-Svc
out-of-scope, since Alt-Svc cannot deliver ECH keys.<a href="#section-2.4-1" class="pilcrow">¶</a></p>
<p id="section-2.4-2">Two options (and there may be more) include:<a href="#section-2.4-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.4-3.1">Add an ech= parameter to Alt-Svc<a href="#section-2.4-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.4-3.2">Defining some better integration between Alt-Svc and HTTPS RRs.  For example,
allow an AltSvc server name to be treated as an "AliasMode" reference to an
HTTPS record.<a href="#section-2.4-3.2" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="better-interactions-with-https-record">
<section id="section-2.5">
        <h3 id="name-better-interactions-with-ht">
<a href="#section-2.5" class="section-number selfRef">2.5. </a><a href="#name-better-interactions-with-ht" class="section-name selfRef">Better Interactions with HTTPS Record</a>
        </h3>
<p id="section-2.5-1">This was deferred out of the HTTPS RR draft.  There are a number of design
options here, but requirements and pros/cons will want to be discussed in-detail
before proposing designs.  Supporting ECH and Alt-Svc together is a primary
goal.<a href="#section-2.5-1" class="pilcrow">¶</a></p>
<p id="section-2.5-2">An important item here is which takes precedence, providing safe and
time-bounded ways to allow Alt-Svc to take precedence over HTTPS records.
Alt-Svc has the ability to be delivered in a user-specific manner -- useful
operationally, but potentially problematic for privacy.  HTTPS records can be
easily revalidated, which is more difficult with an Alt-Svc record.<a href="#section-2.5-2" class="pilcrow">¶</a></p>
<p id="section-2.5-3">Providing a way for Alt-Svc to act as AliasMode references to HTTPS SvcMode
records seems like one clean way for interaction in that it avoids needing to
duplicate SVCB in Alt-Svc.  We would still need to address time-bounding and
trust considerations.<a href="#section-2.5-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="http3-frame-definition">
<section id="section-2.6">
        <h3 id="name-http-3-frame-definition">
<a href="#section-2.6" class="section-number selfRef">2.6. </a><a href="#name-http-3-frame-definition" class="section-name selfRef">HTTP/3 Frame Definition</a>
        </h3>
<p id="section-2.6-1">The ALTSVC frame has not been defined for HTTP/3.  Perhaps it should be
<span>[<a href="#I-D.bishop-httpbis-altsvc-quic" class="xref">I-D.bishop-httpbis-altsvc-quic</a>]</span>. Alternatively, if the frame has not been
widely adopted, should it be deprecated from HTTP/2 instead?<a href="#section-2.6-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="accept-alt-svc-request-header">
<section id="section-2.7">
        <h3 id="name-accept-alt-svc-request-head">
<a href="#section-2.7" class="section-number selfRef">2.7. </a><a href="#name-accept-alt-svc-request-head" class="section-name selfRef">Accept-Alt-Svc Request Header</a>
        </h3>
<p id="section-2.7-1">There is significant variation in client support for the Alt-Svc specification,
including some clients which only implement a subset of the specification.
Having an Accept-Alt-Svc request header that lists a set of supported Alt-Svc
features allows for extension of Alt-Svc but also allows for deprecation.<a href="#section-2.7-1" class="pilcrow">¶</a></p>
<p id="section-2.7-2">If we don't deprecate the frames, we'd also need a SETTINGS equivalent.<a href="#section-2.7-2" class="pilcrow">¶</a></p>
<p id="section-2.7-3">There are potential client fingerprinting concerns here, so we'll want to not go
too far with this.<a href="#section-2.7-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="improvereplace-alt-used-header">
<section id="section-2.8">
        <h3 id="name-improve-replace-alt-used-he">
<a href="#section-2.8" class="section-number selfRef">2.8. </a><a href="#name-improve-replace-alt-used-he" class="section-name selfRef">Improve/Replace Alt-Used Header</a>
        </h3>
<p id="section-2.8-1">There is limited implementation support for Alt-Used out of privacy concerns.
It also only sends a subset of the Alt-Svc record being used, and there are
unclear interactions between Alt-Used and HTTPS RRs.<a href="#section-2.8-1" class="pilcrow">¶</a></p>
<p id="section-2.8-2">Daniel Stenberg points out:<a href="#section-2.8-2" class="pilcrow">¶</a></p>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-2.8-3.1">
            <p id="section-2.8-3.1.1">Alt-Used (RFC 7838 section 5) is a request header that only sends host name +
port number, with no hint if that port number is TCP or UDP (or ALPN name),
which makes at least one large HTTP/3 deployment trigger its Alt-Svc loop
detection when only switching protocols to h3.<a href="#section-2.8-3.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-2.8-4">It is proposed that we replace or redefine Alt-Used and also define how it
interacts with SVCB.  Note that hostile origins have many knobs for getting this
information (e.g., encoding in hostnames, ports, or IPv6 addresses) so a goal
would be to allow non-hostile origins to get information on which Alt-Svc or
SVCB record is being used in a way that doesn't make things worse from a privacy
perspective.<a href="#section-2.8-4" class="pilcrow">¶</a></p>
<p id="section-2.8-5">Some options include:<a href="#section-2.8-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.8-6.1">Just send the whole Alt-Svc or SVCB binding used in the header<a href="#section-2.8-6.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.8-6.2">
            <p id="section-2.8-6.2.1">Have a param encoding an N-bit or N-character value for the record-id.  This
value would be sent as Alt-Used.  How many bits to use is an open question.<a href="#section-2.8-6.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.8-6.2.2.1">Allowing for a dynamic length where the client chooses how many bits or
characters to include based on privacy budget is one attractive but
complicated option.  Server implementers would put the most important info
into earlier bits/characters.<a href="#section-2.8-6.2.2.1" class="pilcrow">¶</a>
</li>
            </ul>
</li>
        </ul>
<p id="section-2.8-7">The goal here is to allow for virtual hosting of alternative services, allowing
the server to know which alternative service was used (eg, for load feedback,
diagnostics/debugging, loop detection, and other operational purposes), but
without hacks like separate ports or IP addresses that leak information to
passive network observers.<a href="#section-2.8-7" class="pilcrow">¶</a></p>
<p id="section-2.8-8">The usefulness of Alt-Used is currently limited by the fact that most servers
simply send ":443" and some clients won't consider any other alternative
offered.<a href="#section-2.8-8" class="pilcrow">¶</a></p>
<p id="section-2.8-9">See some discussion and other options <a href="https://github.com/MikeBishop/dns-alt-svc/issues/107">here</a>.<a href="#section-2.8-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="path-scoped-alt-svc">
<section id="section-2.9">
        <h3 id="name-path-scoped-alt-svc">
<a href="#section-2.9" class="section-number selfRef">2.9. </a><a href="#name-path-scoped-alt-svc" class="section-name selfRef">Path-Scoped Alt-Svc</a>
        </h3>
<p id="section-2.9-1">The largest-scope, most disruptive, and perhaps most controversial item would be
to allow Alt-Svc to be scoped to URL paths with a way to indicate that
transitions to use the Alt-Svc should be done synchronously.<a href="#section-2.9-1" class="pilcrow">¶</a></p>
<p id="section-2.9-2">This is desired for use-cases of large content libraries where an Origin would
like to have clients use different endpoints for different objects while sharing
a single Origin.  This would also likely need negotiation.<a href="#section-2.9-2" class="pilcrow">¶</a></p>
<p id="section-2.9-3">This use-case is similar to that served by <span>[<a href="#I-D.reschke-http-oob-encoding" class="xref">I-D.reschke-http-oob-encoding</a>]</span>,
which is one possible solution.  In that model, the origin retains control of
the entire namespace while delegating delivery of particular objects to other
endpoints.<a href="#section-2.9-3" class="pilcrow">¶</a></p>
<p id="section-2.9-4">Extending Alt-Svc is another approach which might allow more flexibility.  For example:<a href="#section-2.9-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.9-5.1">Client indicates via a request header (eg, Accept-*) or a SETTING that it supports this feature<a href="#section-2.9-5.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.9-5.2">Server's Alt-Svc indicates that the path="/movies/MurderOnTheExampleExpress/"
should be accessed by a particular alternative service<a href="#section-2.9-5.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.9-5.3">Server returns a new 3xx response header response header indicating that the
Alt-Svc should be used synchronously to fetch the response<a href="#section-2.9-5.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="persist-and-caching-concerns">
<section id="section-2.10">
        <h3 id="name-persist-and-caching-concern">
<a href="#section-2.10" class="section-number selfRef">2.10. </a><a href="#name-persist-and-caching-concern" class="section-name selfRef">Persist and Caching Concerns</a>
        </h3>
<p id="section-2.10-1"><span>[<a href="#AltSvc" class="xref">AltSvc</a>]</span> defines the <code>persist</code> parameter.<a href="#section-2.10-1" class="pilcrow">¶</a></p>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-2.10-2.1">
            <p id="section-2.10-2.1.1">Alternative services that are intended to be longer lived (such as those that
are not specific to the client access network) can carry the "persist"
parameter with a value "1" as a hint that the service is potentially useful
beyond a network configuration change.<a href="#section-2.10-2.1.1" class="pilcrow">¶</a></p>
<p id="section-2.10-2.1.2">When alternative services are used to send a client to the most optimal
server, a change in network configuration can result in cached values becoming
suboptimal.  Therefore, clients SHOULD remove from cache all alternative
services that lack the "persist" flag with the value "1" when they detect such
a change, when information about network state is available.<a href="#section-2.10-2.1.2" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-2.10-3">For some clients (e.g. cURL), detecting network changes is very tricky. Certain
clients default to behaving like persist=1 for all alternatives.<a href="#section-2.10-3" class="pilcrow">¶</a></p>
<p id="section-2.10-4">The RFC text today seems to imply that servers factor in client network
properties when deciding what to advertise. That is not true for all
deployments. The recommendation that a client invalidate Alt-Svc cache entries
based on their own network state changes can seem mistaken today. The situation
can potentially get worse with protocol evolution (connection migration,
multipath, etc).<a href="#section-2.10-4" class="pilcrow">¶</a></p>
<p id="section-2.10-5">This feature was designed to address the "mistaken mapping" scenario, where
either DNS mapping or anycast landed you at one POP but the server knows another
one is closer to you:  You're in Seattle, your VPN endpoint and DNS server is in
Sacramento, and so DNS resolution gives you a CDN node in California.  The
California endpoint gives you the unicast IP of the Seattle endpoint as a
friendly shove.<a href="#section-2.10-5" class="pilcrow">¶</a></p>
<p id="section-2.10-6">Similarly, it's one of the best work-around options for off-net DNS (via DoH,
ODoH, etc.) if there is a CDN endpoint very close to the user's network, but
doesn't work so well if the Alt-Svc record keeps being used after a network
change.<a href="#section-2.10-6" class="pilcrow">¶</a></p>
<p id="section-2.10-7">When you're no longer in the same network environment, we can trust mapping
again.  What is the signal this redirect is no longer useful if clients can't
reliably detect network changes?<a href="#section-2.10-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="radical-simplification">
<section id="section-2.11">
        <h3 id="name-radical-simplification">
<a href="#section-2.11" class="section-number selfRef">2.11. </a><a href="#name-radical-simplification" class="section-name selfRef">Radical Simplification</a>
        </h3>
<p id="section-2.11-1">If we are able to reach wide deployment and use of the HTTPS record, it may
supersede many use cases for Alt-Svc.  We should reassess the needs from the new
baseline to see whether Alt-Svc can be radically simplified.  (Chrome never
fully implemented Alt-Svc redirection anyway.)<a href="#section-2.11-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-3">
      <h2 id="name-security-considerations">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-3-1">TODO Security<a href="#section-3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-considerations">
<section id="section-4">
      <h2 id="name-iana-considerations">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-4-1">This document has no IANA actions.<a href="#section-4-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-5">
      <h2 id="name-informative-references">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
      </h2>
<dl class="references">
<dt id="ALPN">[ALPN]</dt>
      <dd>
<span class="refAuthor">Friedl, S.</span>, <span class="refAuthor">Popov, A.</span>, <span class="refAuthor">Langley, A.</span>, and <span class="refAuthor">E. Stephan</span>, <span class="refTitle">"Transport Layer Security (TLS) Application-Layer Protocol Negotiation Extension"</span>, <span class="seriesInfo">RFC 7301</span>, <span class="seriesInfo">DOI 10.17487/RFC7301</span>, <time datetime="2014-07" class="refDate">July 2014</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/rfc7301">https://datatracker.ietf.org/doc/html/rfc7301</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="AltSvc">[AltSvc]</dt>
      <dd>
<span class="refAuthor">Nottingham, M.</span>, <span class="refAuthor">McManus, P.</span>, and <span class="refAuthor">J. Reschke</span>, <span class="refTitle">"HTTP Alternative Services"</span>, <span class="seriesInfo">RFC 7838</span>, <span class="seriesInfo">DOI 10.17487/RFC7838</span>, <time datetime="2016-04" class="refDate">April 2016</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/rfc7838">https://datatracker.ietf.org/doc/html/rfc7838</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="ECH">[ECH]</dt>
      <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refAuthor">Oku, K.</span>, <span class="refAuthor">Sullivan, N.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"TLS Encrypted Client Hello"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-tls-esni-13</span>, <time datetime="2021-08-12" class="refDate">12 August 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-tls-esni-13">https://datatracker.ietf.org/doc/html/draft-ietf-tls-esni-13</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.bishop-httpbis-altsvc-quic">[I-D.bishop-httpbis-altsvc-quic]</dt>
      <dd>
<span class="refAuthor">Bishop, M.</span>, <span class="refTitle">"ALTSVC Frame in HTTP/QUIC"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-bishop-httpbis-altsvc-quic-01</span>, <time datetime="2020-05-15" class="refDate">15 May 2020</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-bishop-httpbis-altsvc-quic-01">https://datatracker.ietf.org/doc/html/draft-bishop-httpbis-altsvc-quic-01</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.pardue-httpbis-dont-be-clear">[I-D.pardue-httpbis-dont-be-clear]</dt>
      <dd>
<span class="refAuthor">Pardue, L.</span> and <span class="refAuthor">A. Ramine</span>, <span class="refTitle">"Reserving the clear ALPN Protocol ID"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-pardue-httpbis-dont-be-clear-00</span>, <time datetime="2021-03-15" class="refDate">15 March 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-pardue-httpbis-dont-be-clear-00">https://datatracker.ietf.org/doc/html/draft-pardue-httpbis-dont-be-clear-00</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.reschke-http-oob-encoding">[I-D.reschke-http-oob-encoding]</dt>
      <dd>
<span class="refAuthor">Reschke, J. F.</span> and <span class="refAuthor">S. Loreto</span>, <span class="refTitle">"'Out-Of-Band' Content Coding for HTTP"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-reschke-http-oob-encoding-12</span>, <time datetime="2017-06-24" class="refDate">24 June 2017</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-reschke-http-oob-encoding-12">https://datatracker.ietf.org/doc/html/draft-reschke-http-oob-encoding-12</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.thomson-tls-snip">[I-D.thomson-tls-snip]</dt>
      <dd>
<span class="refAuthor">Thomson, M.</span>, <span class="refTitle">"Secure Negotiation of Incompatible Protocols in TLS"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-thomson-tls-snip-02</span>, <time datetime="2021-07-06" class="refDate">6 July 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-thomson-tls-snip-02">https://datatracker.ietf.org/doc/html/draft-thomson-tls-snip-02</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SVCB">[SVCB]</dt>
    <dd>
<span class="refAuthor">Schwartz, B.</span>, <span class="refAuthor">Bishop, M.</span>, and <span class="refAuthor">E. Nygren</span>, <span class="refTitle">"Service binding and parameter specification via the DNS (DNS SVCB and HTTPS RRs)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-dnsop-svcb-https-07</span>, <time datetime="2021-08-05" class="refDate">5 August 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-dnsop-svcb-https-07">https://datatracker.ietf.org/doc/html/draft-ietf-dnsop-svcb-https-07</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<div id="acknowledgments">
<section id="appendix-A">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-A-1">Martin Thomson, Lucas Pardue, and Mike Bishop reviewed and commented on <a href="https://docs.google.com/document/d/1QNaXduqohACK93qLPpxkPJ2rHQMgWqUPL-DkZS11htQ/edit?ts=60a5dc92#">an
early version of this
draft</a>.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Erik Nygren</span></div>
<div dir="auto" class="left"><span class="org">Akamai</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:erik+ietf@nygren.org" class="email">erik+ietf@nygren.org</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
